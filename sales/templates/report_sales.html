{% extends 'base.html' %}
{% block title %}Reporte de Ventas{% endblock %}

{% block content %}
    <h1>ðŸ“Š Reporte de Ventas por PerÃ­odo</h1>
    <p class="lead">Genera el listado de ventas (POS y E-commerce) para el anÃ¡lisis.</p>
    <hr>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="card-title">Filtros de Reporte</h5>
            <form id="report-form" method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="date_from" class="form-label">Fecha Desde</label>
                    <input type="date" class="form-control" name="date_from" id="date_from" value="{{ date_from }}">
                </div>
                <div class="col-md-4">
                    <label for="date_to" class="form-label">Fecha Hasta</label>
                    <input type="date" class="form-control" name="date_to" id="date_to" value="{{ date_to }}">
                </div>
                <div class="col-md-4">
                    <label for="branch_id" class="form-label">Sucursal</label>
                    <select class="form-select" name="branch_id" id="branch_id">
                        <option value="">Todas las Sucursales</option>
                        {% for branch in branches %}
                            <option value="{{ branch.id }}" {% if branch.id|slugify == selected_branch_id|slugify %}selected{% endif %}>
                                {{ branch.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-success">Generar Reporte</button>
                </div>
            </form>
        </div>
    </div>
    
    {% if report_data %}
    <h2 class="mt-5">Resultados ({{ report_data|length }} Transacciones)</h2>
    <div class="alert alert-primary">
        Total de Ventas en el PerÃ­odo: <strong>${{ total_ventas|floatformat:0 }}</strong>
    </div>

    <table class="table table-bordered table-striped">
        <thead class="table-info">
            <tr>
                <th>ID Venta</th>
                <th>Sucursal</th>
                <th>Vendedor</th>
                <th>MÃ©todo Pago</th>
                <th>Total</th>
                <th>Fecha</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in report_data %}
            <tr>
                <td>{{ sale.id }}</td>
                <td>{{ sale.branch.name }}</td>
                <td>{{ sale.user.username }}</td>
                <td>{{ sale.payment_method }}</td>
                <td><span class="fw-bold">${{ sale.total|floatformat:0 }}</span></td>
                <td>{{ sale.created_at|date:"Y-m-d H:i" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif is_filtered %}
        <div class="alert alert-warning">No se encontraron ventas para los filtros seleccionados.</div>
    {% endif %}
{% endblock %}