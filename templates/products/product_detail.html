{% extends 'base.html' %}
{% block title %}Detalle de {{ product.name }}{% endblock %}

{% block content %}
    <h1>Detalle del Producto: {{ product.name }}</h1>
    <hr>
    <div class="card p-4 shadow-sm">
        
        <div class="row">
            <div class="col-md-6">
                <h5>Información Principal</h5>
                <dl class="row">
                    <dt class="col-sm-4">SKU:</dt>
                    <dd class="col-sm-8">{{ product.sku }}</dd>
                    
                    <dt class="col-sm-4">Categoría:</dt>
                    <dd class="col-sm-8"><span class="badge bg-secondary">{{ product.category }}</span></dd>

                    <dt class="col-sm-4">Descripción:</dt>
                    <dd class="col-sm-8">{{ product.description|default:"N/A" }}</dd>
                </dl>
            </div>
            <div class="col-md-6">
                <h5>Información Financiera</h5>
                <dl class="row">
                    <dt class="col-sm-4">Precio Venta:</dt>
                    <dd class="col-sm-8"><strong class="text-primary">${{ product.price|floatformat:0 }}</strong></dd>

                    <dt class="col-sm-4">Costo (Compra):</dt>
                    <dd class="col-sm-8">${{ product.cost|floatformat:0 }}</dd>
                    
                    <dt class="col-sm-4">Margen Bruto:</dt>
                    <dd class="col-sm-8">
                        {% with margin=(product.price|sub:product.cost|div:product.price|mul:100) %}
                            {{ margin|floatformat:2|default:"N/A" }}%
                        {% endwith %}
                    </dd>
                </dl>
            </div>
        </div>
        
        <h5 class="mt-4">Inventario en Sucursales</h5>
        <p class="text-muted small">Datos de stock combinados (obtenidos del endpoint `/api/branches/{id}/inventory/` o similar).</p>

        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Sucursal</th>
                    <th>Stock Actual</th>
                    <th>Punto de Reorden</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {% for inv in inventory_data %}
                <tr>
                    <td>{{ inv.branch_name }}</td>
                    <td>
                        <span class="fw-bold 
                            {% if inv.stock <= inv.reorder_point %}text-danger{% elif inv.stock < 10 %}text-warning{% else %}text-success{% endif %}">
                            {{ inv.stock }}
                        </span>
                    </td>
                    <td>{{ inv.reorder_point }}</td>
                    <td>
                        {% if inv.stock <= inv.reorder_point %}
                            <span class="badge bg-danger"><i class="fas fa-exclamation-triangle"></i> ¡Reordenar!</span>
                        {% else %}
                            <span class="badge bg-success">Suficiente</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4">Este producto no está asignado a ninguna sucursal o no tiene stock registrado.</td></tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="mt-3 text-end">
            <a href="{% url 'products:product_update' product.id %}" class="btn btn-warning"><i class="fas fa-edit"></i> Editar Producto</a>
            <a href="{% url 'products:product_list' %}" class="btn btn-outline-secondary">Volver al Listado</a>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
{% load custom_tags %} 
{% endblock %}