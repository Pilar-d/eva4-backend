{% extends 'base.html' %}
{% block title %}
    {% if supplier.pk %}Editar Proveedor{% else %}Registrar Proveedor{% endif %}
{% endblock %}

{% block content %}
    <header class="mb-4">
        <h1>
            {% if supplier.pk %}
                <i class="fas fa-edit"></i> Editar Proveedor: {{ supplier.name }}
            {% else %}
                <i class="fas fa-truck-loading"></i> Registrar Nuevo Proveedor
            {% endif %}
        </h1>
    </header>
    <hr>
    
    <form method="post" action="{% if supplier.pk %}{% url 'products:supplier_update' supplier.pk %}{% else %}{% url 'products:supplier_create' %}{% endif %}" class="row g-3 needs-validation" novalidate>
        {% csrf_token %}

        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <div class="col-md-6">
            <label for="id_name" class="form-label">Nombre del Proveedor</label>
            <input type="text" name="name" id="id_name" class="form-control" 
                   value="{% if post_data.name %}{{ post_data.name }}{% elif supplier %}{{ supplier.name }}{% endif %}" 
                   required>
        </div>
        
        <div class="col-md-6">
            <label for="id_rut" class="form-label">RUT (Validación Chilena)</label>
            <input type="text" name="rut" id="id_rut" class="form-control" 
                   value="{% if post_data.rut %}{{ post_data.rut }}{% elif supplier %}{{ supplier.rut }}{% endif %}" 
                   placeholder="12.345.678-9" 
                   pattern="[0-9]{1,2}\.?[0-9]{3}\.?[0-9]{3}-[0-9Kk]"
                   required>
        </div>

        <div class="col-12">
            <label for="id_contact" class="form-label">Contacto / Teléfono</label>
            <input type="text" name="contact" id="id_contact" class="form-control" 
                   value="{% if post_data.contact %}{{ post_data.contact }}{% elif supplier %}{{ supplier.contact }}{% endif %}"
                   required>
        </div>

        <div class="col-12 mt-4">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-save"></i> {% if supplier.pk %}Guardar Cambios{% else %}Registrar Proveedor{% endif %}
            </button>
            <a href="{% url 'products:supplier_list' %}" class="btn btn-outline-secondary btn-lg">Volver</a>
        </div>
    </form>
{% endblock %}

{% block extra_js %}
<script>
    // Inicialización de la validación de Bootstrap 5
    (function () {
        'use strict'
        var form = document.querySelector('.needs-validation')
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })()
</script>
{% endblock %}